{% extends "base.html" %}

{% block title %}Quiz History{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-4">
    <h1 class="text-4xl font-extrabold mb-8 text-gray-900">Your AI Quiz History üìù</h1>

    {% if history %}
        <div class="space-y-6">
            {% for attempt in history %}
            <div x-data="{ open: false }" class="bg-white p-6 rounded-xl shadow-lg border-l-4 {{ 'border-green-500' if attempt.percentage >= 70 else 'border-yellow-500' if attempt.percentage >= 50 else 'border-red-500' }} transition hover:shadow-xl">
                <div class="flex justify-between items-center mb-3 border-b pb-3">
                    <h2 class="text-2xl font-bold text-indigo-700">{{ attempt.topic }}</h2>
                    <span class="text-sm text-gray-500">{{ attempt.date_taken.strftime('%B %d, %Y') }}</span>
                </div>
                
                <p class="text-lg mb-4">
                    Score: <strong class="text-3xl font-extrabold {{ 'text-green-600' if attempt.percentage >= 70 else 'text-yellow-600' if attempt.percentage >= 50 else 'text-red-600' }}">{{ attempt.score }} / {{ attempt.total_questions }}</strong>
                    (<span class="font-bold">{{ "%.1f" | format(attempt.percentage) }}%</span>)
                </p>

                <button @click="open = !open" class="text-blue-500 hover:text-blue-700 text-sm font-semibold transition">
                    <span x-show="!open">Show Details ({{ attempt.detail | length }} Qs)</span>
                    <span x-show="open">Hide Details</span>
                </button>

                <div x-show="open" x-collapse.duration.400ms class="mt-4 space-y-3 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    {% for q_detail in attempt.detail %}
                        <div class="text-sm p-3 rounded-md {{ 'bg-green-100' if q_detail.is_correct else 'bg-red-100' }}">
                            <p class="font-medium">Q: {{ q_detail.question }}</p>
                            <p>Your Answer: <strong class="{{ 'text-green-800' if q_detail.is_correct else 'text-red-800' }}">{{ q_detail.user_answer }}</strong></p>
                            {% if not q_detail.is_correct %}
                                <p>Correct Answer: <span class="text-indigo-700 font-semibold">{{ q_detail.correct_answer }}</span></p>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="bg-blue-100 p-6 rounded-lg text-blue-800 border-l-4 border-blue-500">
            <p>You haven't taken any AI generated quizzes yet! Go to the <a href="{{ url_for('main.ai_quiz_generator_page') }}" class="font-bold underline text-blue-800 hover:text-blue-900 transition">AI Quiz Generator</a> to start.</p>
        </div>
    {% endif %}

</div>

<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
{% endblock %}